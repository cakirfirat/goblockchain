<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet</title>
    <script src="https://code.jquery.com/jquery-3.7.0.js"
        integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script>
        $(function () {
            $.ajax({
                url: "/wallet",
                type: "POST",
                success: function (response) {
                    $("#public_key").val(response["public_key"]);
                    $("#private_key").val(response["private_key"]);
                    $("#blockchain_address").val(response["blockchain_address"]);
                    console.info(response);
                },
                error: function (error) {
                    console.error(error);
                }
            })
            $("#send_money_button").click(function () {
                let confirm_text = "Are you sure to send?";
                let confirm_result = confirm(confirm_text);
                if (confirm_result !== true) {
                    alert("cancelled");
                    return
                }

                let transaction_data = {
                    "sender_private_key": $("#private_key").val(),
                    "sender_blockchain_address": $("#blockchain_address").val(),
                    "recipient_blockchain_address": $("#recipient_blockchain_address").val(),
                    "sender_public_key": $("#public_key").val(),
                    "value": $("#send_amount").val()
                };

                $.ajax({
                    url: "/transaction",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(transaction_data),
                    success: function (response) {
                        console.info(response)
                        // if ($.parseJSON(response).message === 'fail') {
                        //     alert("failed")
                        //     return
                        // }
                        alert("send success");
                    },
                    error: function (response) {
                        console.error(response)
                        alert("Send failed");
                    }
                })
            })

            function reload_amount() {
                let data = { 'blockchain_address': $('#blockchain_address').val() }
                $.ajax({
                    url: '/wallet/amount',
                    type: 'GET',
                    data: data,
                    success: function (response) {
                        let amount = response['amount'];
                        $('#wallet_amount').text(amount)
                        console.info(amount)
                    },
                    error: function (error) {
                        console.error(error)
                    }
                })
            }
            $('#reload_wallet').click(function () {
                reload_amount();
            });

            // setInterval(reload_amount,3000)

        })
    </script>
</head>

<body>

    <div class="container">
        <h1 class="text-center mt-3">Wallet</h1>
        <div id="wallet_amount">0</div>
        <button class="btn btn-outline-success" id="reload_wallet">Reload Wallet</button>
        <br>
        <p class="mt-3">Public Key</p>
        <textarea class="form-control" name="" id="public_key" cols="100" rows="2"></textarea>
        <br>
        <p>Private</p>
        <textarea class="form-control" name="" id="private_key" cols="100" rows="2"></textarea>
        <br>
        <p>Blockchain Address</p>
        <textarea class="form-control" name="" id="blockchain_address" cols="100" rows="2"></textarea>
    </div>
    <div class="container">
        <h1 class="text-center mt-3">Send Money</h1>
        <div>
            Adress: <input type="text" name="" id="recipient_blockchain_address" class="form-control">
            <br>
            Amount: <input type="text" id="send_amount" type="text" class="form-control">
            <br>
            <button id="send_money_button" class="btn btn-outline-success">Send</button>
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
</body>

</html>